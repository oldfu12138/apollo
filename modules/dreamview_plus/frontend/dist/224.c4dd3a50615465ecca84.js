"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[224],{92606:(e,t,n)=>{n.r(t),n.d(t,{default:()=>Ht});var r=n(22590),o=n.n(r),i=n(17291);function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){var r,o,i,l;r=e,o=t,i=n[t],l=function(e,t){if("object"!=a(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=a(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(o),(o="symbol"==a(l)?l:String(l))in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,l=[],u=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(l.push(r.value),l.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return l}}(e,t)||function(e,t){if(e){if("string"==typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var f=(0,r.createContext)(void 0),m=function(e){var t=e.initialPath,n=void 0===t?"/":t,i=e.children,a=c((0,r.useState)(n),2),l=a[0],u=a[1],s=(0,r.useMemo)((function(){return{currentPath:l,navigate:u}}),[l]);return o().createElement(f.Provider,{value:s},i)},p=function(e){var t=e.path,n=e.children,i=(0,r.useContext)(f);if(!i)throw new Error("Route must be used within SimpleRouter");return i.currentPath===t?o().createElement(o().Fragment,null,n):null},d=function(){var e=(0,r.useContext)(f);if(!e)throw new Error("useNavigate must be used within SimpleRouter");return e.navigate},y=function(e){var t=e.path,n=e.style,i=e.children,a=(0,r.useContext)(f);if(!a)throw new Error("KeepAlive must be used within SimpleRouter");var l=a.currentPath===t,s=c((0,r.useState)(!1),2),m=s[0],p=s[1];return(0,r.useEffect)((function(){l&&p(!0)}),[l]),m?o().createElement("div",{style:u(u({},n),{},{display:l?"block":"none"})},i):null},b=n(80151),v=n(58938),g=n(54067),h=n(35220),E=n.n(h),w=n(85404),O=n(36469),S=n(56733),P={Perception:{polygon:{defaultVisible:!0,currentVisible:!0,vizKey:"polygon"},boundingbox:{defaultVisible:!1,currentVisible:!1,vizKey:"boundingbox"},pointCloud:{defaultVisible:!1,currentVisible:!1,vizKey:"pointCloud"},unknownMovable:{defaultVisible:!0,currentVisible:!0,vizKey:"unknownMovable"},vehicle:{defaultVisible:!0,currentVisible:!0,vizKey:"vehicle"},unknownStationary:{defaultVisible:!0,currentVisible:!0,vizKey:"unknownUnmovable"},pedestrian:{defaultVisible:!0,currentVisible:!0,vizKey:"pedestrian"},unknown:{defaultVisible:!0,currentVisible:!0,vizKey:"unknown"},bicycle:{defaultVisible:!0,currentVisible:!0,vizKey:"bicycle"},cipv:{defaultVisible:!0,currentVisible:!0,vizKey:"cipv"},velocity:{defaultVisible:!0,currentVisible:!0,vizKey:"obstacleVelocity"},heading:{defaultVisible:!0,currentVisible:!0,vizKey:"obstacleHeading"},id:{defaultVisible:!0,currentVisible:!0,vizKey:"obstacleId"},distanceAndSpeed:{defaultVisible:!0,currentVisible:!0,vizKey:"obstacleDistanceAndSpeed"},laneMarker:{defaultVisible:!1,currentVisible:!1,vizKey:"laneMarker"},lidarSensor:{defaultVisible:!1,currentVisible:!1,vizKey:"lidarSensor"},radarSensor:{defaultVisible:!1,currentVisible:!1,vizKey:"radarSensor"},cameraSensor:{defaultVisible:!1,currentVisible:!1,vizKey:"cameraSensor"},v2x:{defaultVisible:!1,currentVisible:!1,vizKey:"v2x"}},Prediction:{priority:{defaultVisible:!0,currentVisible:!0,vizKey:"obstaclePriority"},majorPredictionLine:{defaultVisible:!0,currentVisible:!0,vizKey:"majorPredictionLine"},gaussianInfo:{defaultVisible:!1,currentVisible:!1,vizKey:"gaussianInfo"},minorPredictionLine:{defaultVisible:!0,currentVisible:!0,vizKey:"minorPredictionLine"},interactiveTag:{defaultVisible:!0,currentVisible:!0,vizKey:"obstacleInteractiveTag"}},Routing:{routingLine:{defaultVisible:!0,currentVisible:!0,vizKey:"routingLine"}},Decision:{mainDecision:{defaultVisible:!0,currentVisible:!0,vizKey:"mainDecision"},obstacleDecision:{defaultVisible:!0,currentVisible:!0,vizKey:"obstacleDecision"}},Planning:{planningCar:{defaultVisible:!1,currentVisible:!1,vizKey:"planningCar"},planningTrajectoryLine:{defaultVisible:!0,currentVisible:!0,vizKey:"planningTrajectoryLine"},planningReferenceLine:{defaultVisible:!1,currentVisible:!1,vizKey:"PlanningReferenceLine"},planningBoundaryLine:{defaultVisible:!1,currentVisible:!1,vizKey:"PlanningBoundaryLine"}},Position:{localization:{defaultVisible:!0,currentVisible:!0,vizKey:"localization"},gps:{defaultVisible:!1,currentVisible:!1,vizKey:"gps"},shadow:{defaultVisible:!1,currentVisible:!1,vizKey:"shadow"}},Map:{crosswalk:{defaultVisible:!0,currentVisible:!0,vizKey:"crosswalk"},clearArea:{defaultVisible:!0,currentVisible:!0,vizKey:"clearArea"},junction:{defaultVisible:!1,currentVisible:!1,vizKey:"junction"},pncJunction:{defaultVisible:!1,currentVisible:!1,vizKey:"pncJunction"},lane:{defaultVisible:!0,currentVisible:!0,vizKey:"lane"},road:{defaultVisible:!1,currentVisible:!1,vizKey:"road"},signal:{defaultVisible:!0,currentVisible:!0,vizKey:"signal"},stopSign:{defaultVisible:!0,currentVisible:!0,vizKey:"stopSign"},yieldSign:{defaultVisible:!0,currentVisible:!0,vizKey:"yieldSign"},speedBump:{defaultVisible:!0,currentVisible:!0,vizKey:"speedBump"},parkingSpace:{defaultVisible:!0,currentVisible:!0,vizKey:"parkingSpace"},parkingSpaceId:{defaultVisible:!1,currentVisible:!1,vizKey:"parkingSpaceId"},laneId:{defaultVisible:!1,currentVisible:!1,vizKey:"laneId"},egoBoudingBox:{defaultVisible:!1,currentVisible:!1,vizKey:"boudingBox"}}},C=function(e){var t={};return Object.keys(e).forEach((function(n){var r=e[n];Object.keys(r).forEach((function(e){var o=r[e];t[n]=t[n]||{},t[n][o.vizKey]=o.currentVisible}))})),t},x=new O.mM(O.SA.layerMenuParams),j=function(){return x.get()||P},R=n(52007),k=n(16125),N=n(27140);function A(e){return A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},A(e)}function I(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function F(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?I(Object(n),!0).forEach((function(t){T(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):I(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function T(e,t,n){var r;return r=function(e,t){if("object"!=A(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=A(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(t),(t="symbol"==A(r)?r:String(r))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function M(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,l=[],u=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(l.push(r.value),l.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return l}}(e,t)||function(e,t){if(e){if("string"==typeof e)return L(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?L(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function L(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function V(e){var t,n,a=(0,S.Z)(),l=a.classes,u=a.cx,c=e.carviz,s=e.pointCloudFusionChannel,f=e.handlePointCloudVisible,m=e.pointcloudChannels,p=e.updatePointcloudChannel,d=e.curChannel,y=e.setCurChannel,b=e.handleReferenceLineVisible,h=e.handleBoundaryLineVisible,E=e.handleTrajectoryLineVisible,w=e.handleBoudingBoxVisible,A=(0,g.$G)("layerMenu").t,I=(0,R.R)().panelId,L=(0,k.Z)().metadata,V=(0,r.useCallback)((function(e){if("pointCloud"===e){var t,n=null===(t=L.find((function(e){return e.dataName===v.DU.POINT_CLOUD})))||void 0===t?void 0:t.channels;if(Array.isArray(n)){var r=n.some((function(e){return e.channelName.includes("compensator")})),o=n.some((function(e){return e.channelName.includes("fusion")}));return!(r||o)}}return!1}),[L]),D=j();x.set(D),c.option.updateLayerOption(C(D),"vehicle");var z=M((0,r.useState)(D),2),_=z[0],B=z[1],K=M((0,r.useState)(Object.keys(_)),1)[0],U=M((0,r.useState)(K[0]),2),W=U[0],H=U[1],Z=M((0,r.useState)(_[W]),2),$=Z[0],G=Z[1],Y=(0,r.useRef)(),J=(0,O._)("".concat(I,"-viz-pointcloud-channel")),q=(0,r.useMemo)((function(){var e=(_[W].pointCloud||{}).currentVisible;return Y.current=e,o().createElement("li",{className:l["layer-menu-content-right-li"],key:"pointCloud"},o().createElement("span",{className:l["layer-menu-content-right-switch"]},o().createElement(i.XZ,{checked:e,defaultChecked:e,onChange:function(e){var t=e.target.checked;Y.current=t;var n=F(F({},_[W]),{},{pointCloud:F(F({},_[W].pointCloud),{},{currentVisible:t})}),r=F(F({},_),{},T({},W,n));G((function(){return n})),B((function(){return r})),c.option.updateLayerOption(C(r),"vehicle"),x.set(r),t&&f&&f(e.target.checked),t||f&&f(e.target.checked)}})),o().createElement("span",{className:l["layer-menu-content-right-label"]},A("pointCloud")))}),[c.option,V,l,W,f,_,s,A]);return o().createElement("div",{className:l["layer-menu-container"]},o().createElement("div",{className:l["layer-menu-header"]},o().createElement("div",{className:l["layer-menu-header-left"]},A("layerMenu")),o().createElement("div",{className:l["layer-menu-header-right"]},o().createElement("div",{className:l["layer-menu-header-reset-btn"],onClick:function(){B((function(){return P})),c.option.updateLayerOption(C(P),"vehicle"),x.set(P)}},A("restoreDefaultSettings")))),o().createElement("div",{className:l["layer-menu-content"]},o().createElement("div",{className:l["layer-menu-content-left"]},K.map((function(e){return o().createElement("li",{key:e,className:u(l["layer-menu-content-left-li"],T({},l["li-active"],W===e)),onClick:function(){H(e),G(_[e])}},o().createElement("span",null,A(e)))}))),o().createElement("div",{className:l["layer-menu-content-right"]},"Perception"===W&&o().createElement(o().Fragment,null,o().createElement("li",{className:l["layer-menu-content-right-li"]},o().createElement("span",{className:l["layer-menu-content-right-switch"]},o().createElement(i.Y8,{checked:null==_||null===(t=_.Perception)||void 0===t||null===(t=t.polygon)||void 0===t?void 0:t.currentVisible,onChange:function(e){if(e.target.checked){var t=F(F({},_.Perception),{},{polygon:F(F({},_.Perception.polygon),{},{currentVisible:!0}),boundingbox:F(F({},_.Perception.boundingbox),{},{currentVisible:!1})}),n=F(F({},_),{},T({},W,t));G((function(){return t})),B((function(){return n})),c.option.updateLayerOption(C(n),"vehicle"),x.set(n)}}})),o().createElement("span",{className:l["layer-menu-content-right-label"]},A("polygon"))),o().createElement("li",{className:l["layer-menu-content-right-li"]},o().createElement("span",{className:l["layer-menu-content-right-switch"]},o().createElement(i.Y8,{checked:null==_||null===(n=_.Perception)||void 0===n||null===(n=n.boundingbox)||void 0===n?void 0:n.currentVisible,onChange:function(e){if(e.target.checked){var t=F(F({},_.Perception),{},{polygon:F(F({},_.Perception.polygon),{},{currentVisible:!1}),boundingbox:F(F({},_.Perception.boundingbox),{},{currentVisible:!0})}),n=F(F({},_),{},T({},W,t));G((function(){return t})),B((function(){return n})),c.option.updateLayerOption(C(n),"vehicle"),x.set(n)}}})),o().createElement("span",{className:l["layer-menu-content-right-label"]},A("boundingbox"))),o().createElement("div",{className:l["layer-menu-horizontal-line"]})),q,o().createElement(N.Z,{disabled:!Y.current,value:d,options:m,onChange:function(e){return function(e){y(e),p(e),J.set(e)}(e)}}),o().createElement("div",{className:l["layer-menu-horizontal-line"]}),Object.keys($).map((function(e){if("pointCloud"===e)return null;var t=(_[W][e]||{}).currentVisible;return"polygon"!==e&&"boundingbox"!==e&&o().createElement("li",{className:l["layer-menu-content-right-li"],key:e},o().createElement("span",{className:l["layer-menu-content-right-switch"]},o().createElement(i.XZ,{checked:t,disabled:V(e),defaultChecked:t,onChange:function(t){var n=t.target.checked,r=F(F({},_[W]),{},T({},e,F(F({},_[W][e]),{},{currentVisible:n}))),o=F(F({},_),{},T({},W,r));G((function(){return r})),B((function(){return o})),c.option.updateLayerOption(C(o),"vehicle"),x.set(o),n&&"pointCloud"===e&&!V(e)&&s&&f&&f(t.target.checked),n||"pointCloud"!==e||f&&f(t.target.checked),"planningReferenceLine"===e&&b(n),"planningBoundaryLine"===e&&h(n),"planningTrajectoryLine"===e&&E(n),"egoBoudingBox"===e&&w(n)}})),o().createElement("span",{className:l["layer-menu-content-right-label"]},A(e)))})))))}const D=o().memo(V);var z=n(79424),_=n(51999),B=n(4492),K=n(10108),U=n(5843);function W(e){return W="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},W(e)}function H(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Z(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?H(Object(n),!0).forEach((function(t){var r,o,i,a;r=e,o=t,i=n[t],a=function(e,t){if("object"!=W(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=W(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(o),(o="symbol"==W(a)?a:String(a))in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):H(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function $(){return(0,U.BH)((function(e){return{"routing-editing-op-area":Z({width:192,height:32,color:"#A6B5CC",borderRadius:6,position:"absolute",top:24,left:24},e.util.flex("row","space-between","center")),"routing-editing-btn":Z(Z({width:144,height:32,borderRadius:6,background:"#343C4D"},e.util.flexCenterCenter),{},{"&:hover":{cursor:"pointer",background:"#38465A",color:"#fff"}}),"routing-editing-btn__icon":{marginRight:6},"routing-editing-btn__text":{fontFamily:"PingFangSC-Regular",fontSize:14},"common-routing-editing-btn":Z(Z({width:32,minWidth:32,height:32,minHeight:32,background:"#343C4D",borderRadius:6},e.util.flexCenterCenter),{},{"&:hover":{cursor:"pointer",background:"#38465A",color:"#fff"}}),"common-routing-editing-btn__icon":{},"routing-editing-disable":{cursor:"not-allowed","& .routing-editing-btn-disable":{color:"#515761",pointerEvents:"none",background:"#383D47"},"& .common-routing-editing-btn-disbale":{color:"#515761",pointerEvents:"none",background:"#383D47"}},"common-routing-popover-ordinary":{"& .dreamview-popover-inner, & .dreamview-popover-arrow::after":{background:"rgba(80, 88, 102, 0.8) !important"},"& .dreamview-popover-arrow::after":{background:"rgba(80, 88, 102, 0.8) !important"}},"common-routing-popover-functional":{"& .dreamview-popover-inner,& .dreamview-popover-arrow::before, & .dreamview-popover-arrow::after":{color:"#A6B5CC !important",background:"rgba(40, 43, 54) !important"},"& .dreamview-popover-arrow::before":{background:"rgba(40, 43, 54) !important"},"& .dreamview-popover-arrow::after":{background:"rgba(40, 43, 54) !important"}}}}))()}var G=(0,r.forwardRef)((function(e,t){var n=e.onClick,r=$(),a=r.classes,l=r.cx,u=(0,g.$G)("routeEditing").t;return o().createElement("div",{id:"routing-editing-btn",className:l(a["routing-editing-btn"],"routing-editing-btn-disable"),onClick:n,ref:t},o().createElement("i",{className:a["routing-editing-btn__icon"]},o().createElement(i.xI,null)),o().createElement("div",{className:a["routing-editing-btn__text"]},u("routingEditing")))})),Y=(0,r.forwardRef)((function(e,t){var n=e.onClick,r=$(),a=r.classes,l=r.cx;return o().createElement("div",{className:l(a["common-routing-editing-btn"],"common-routing-editing-btn-disbale"),onClick:n,ref:t},o().createElement("i",{className:a["common-routing-editing-btn__icon"]},o().createElement(i.xG,null)))}));G.displayName="RoutingEditingBtn",Y.displayName="CommonRoutingEditingBtn";var J=n(5911),q=n(61534),X=n(86944),Q=n(64698);function ee(e){return ee="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ee(e)}function te(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ne(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?te(Object(n),!0).forEach((function(t){var r,o,i,a;r=e,o=t,i=n[t],a=function(e,t){if("object"!=ee(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=ee(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(o),(o="symbol"==ee(a)?a:String(a))in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):te(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function re(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,l=[],u=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(l.push(r.value),l.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return l}}(e,t)||oe(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function oe(e,t){if(e){if("string"==typeof e)return ie(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ie(e,t):void 0}}function ie(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ae(e){var t,n=e.EE,a=e.destroy,l=e.mainApi,u=e.panelContext,c=e.routeManager,s=e.routingEditor,f=e.isMainConnected,m=e.defaultRoutingList,p=e.createCommonRoutingSuccessFunctional,d=re(i.l0.useForm(),1)[0],y=(0,U.BH)((function(e){return{"routing-modal":{"& .dreamview-modal-wrap":{zIndex:"1040"},"& .dreamview-modal-mask":{zIndex:"1040"},"& .dreamview-modal-content":{width:"492px","& .dreamview-modal-body":{marginTop:"30px",label:{color:"#FFFFFF",fontFamily:"PingFangSC-Regular",fontWeight:"400"},"& .dreamview-form":{"& .ant-form-item":{marginBottom:"16px"},"& > div:nth-of-type(1)":{"& .ant-form-item-label":{"& label":{position:"relative",top:"4px"}}}}}},"& .dreamview-modal-footer":{display:"flex",justifyContent:"center",alignItems:"center","& > button":{width:"74px",height:"40px",borderRadius:"8px"},"& > button:nth-of-type(1)":{color:"#FFFFFF",background:"#282B36",border:"1px solid rgba(124,136,153,1)"},"& > button:nth-of-type(2)":{background:"#3288FA",borderRadius:"8px",marginLeft:"24px !important"}}},"routing-form-initial":{fontFamily:"PingFangSC-Regular",fontSize:"14px",fontWeight:"400",color:"#FFFFFF",marginLeft:"39px",marginBottom:"16px",display:"flex"},"routing-form-initial-content":{width:"320px",color:"#FFFFFF",display:"flex",justifyContent:"space-between"},"routing-form-initial-content-heading":{width:"111px"},"routing-form-way":{height:"264px",border:"1px solid rgba(56,59,69,1)",borderRadius:"8px",padding:"16px 0px 16px 45px",marginBottom:"12px"},"routing-form-way-con":{fontFamily:"PingFangSC-Regular",fontSize:"14px",fontWeight:"400",color:"#FFFFFF",display:"flex"},"routing-form-way-content":{flex:"1"},"routing-form-way-item":{color:"#FFFFFF",marginBottom:"8px",display:"flex",justifyContent:"space-between"},"routing-form-way-item-heading":{width:"111px"},"routing-form-colon":{color:"#A6B5CC",marginRight:"6px"},"routing-form-colon-distance":{marginLeft:"2px"},"routing-form-loop-disable":{background:"rgb(40, 93, 164)","& .dreamview-switch-handle":{background:"rgb(190, 206, 227)",borderRadius:"3px"}},"create-modal-form":{"& .ant-form-item-label":{"& label":{color:"#A6B5CC !important"}}}}}))(),b=(y.cx,y.classes),h=(0,g.$G)("routeEditing").t,E=c.currentRouteMix,w=E.getCurrentRouteMix().currentRouteLoop.currentRouteLoopState,O=null===(t=E.getCurrentRouteMix().currentRouteLoop)||void 0===t?void 0:t.currentRouteLoopTimes,S=re((0,r.useState)([]),2),P=S[0],C=S[1],x=re((0,r.useState)({x:0,y:0}),2),j=x[0],R=x[1];return(0,r.useEffect)((function(){var e=s.initiationMarker.initiationMarkerPosition,t=s.pathwayMarker.pathWatMarkerPosition;e?R(e):l.getStartPoint().then((function(e){R({x:e.x,y:e.y,heading:null==e?void 0:e.heading})})),C(t)}),[f]),o().createElement(i.u_,{title:h("routeCreateCommonBtn"),okText:h("create"),cancelText:h("cancel"),open:!0,onOk:function(){d.validateFields().then((function(){if(f&&l){var e=d.getFieldsValue();if(e.loopRouting){var t=Number(e.cycleNumber);e.cycleNumber=t>10?10:t}delete e.loopRouting,l.saveDefaultRouting(ne(ne({},e),{},{routingType:v.Sw.DEFAULT_ROUTING,point:[j].concat((r=P,function(e){if(Array.isArray(e))return ie(e)}(r)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(r)||oe(r)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()))})).then((function(){n.emit(Q.l.SimControlRoute,{panelId:u.panelId,routeInfo:{initialPoint:j,wayPoint:P,cycleNumber:null==e?void 0:e.cycleNumber}}),p(),a(),(0,i.yw)({type:"success",content:h("createCommonRouteSuccess")})}))}var r}))},onCancel:function(){a()},rootClassName:b["routing-modal"]},o().createElement(i.l0,{form:d,name:"form",className:b["create-modal-form"],initialValues:{loopRouting:w,cycleNumber:O}},o().createElement(i.l0.Item,{label:h("name"),style:{marginLeft:"74px"},name:"name",rules:[function(e){return e.getFieldValue,{validator:function(e,t){return t?t&&m.find((function(e){return e.name===t}))?Promise.reject(new Error(h("alreadyExists"))):Promise.resolve():Promise.reject(new Error(h("pleaseEnter")))}}}]},o().createElement(i.II,{placeholder:"Please enter",style:{width:"252px",height:"40px"}})),o().createElement("div",{className:b["routing-form-initial"]},o().createElement("div",{className:b["routing-form-colon"]},h("initialPoint"),o().createElement("span",{className:b["routing-form-colon-distance"]},":")),o().createElement("div",{className:b["routing-form-initial-content"]},o().createElement("div",null,"[".concat(j.x.toFixed(3)," ，").concat(j.y.toFixed(3),"]")),o().createElement("div",{className:b["routing-form-initial-content-heading"]},null!=j&&j.heading?j.heading.toFixed(3):"-"))),o().createElement(X.Z,{className:b["routing-form-way"]},o().createElement("div",{className:b["routing-form-way-con"]},o().createElement("div",{className:b["routing-form-colon"]},h("wayPoint"),o().createElement("span",{className:b["routing-form-colon-distance"]},":")),o().createElement("div",{className:b["routing-form-way-content"]},null==P?void 0:P.map((function(e,t){return o().createElement("div",{key:"".concat(e.x).concat(e.y).concat(t+1),className:b["routing-form-way-item"]},o().createElement("div",null,"[".concat(e.x.toFixed(3),"，").concat(e.y.toFixed(3),"]")),o().createElement("div",{className:b["routing-form-way-item-heading"]},null!=e&&e.heading?e.heading.toFixed(3):"-"))}))))),w&&o().createElement(i.l0.Item,{label:h("loopRouting"),style:{marginLeft:"16px"},name:"loopRouting",valuePropName:"checked"},o().createElement(i.rs,{disabled:!0,className:b["routing-form-loop-disable"]})),w&&o().createElement(i.l0.Item,{label:h("setLooptimes"),style:{marginLeft:"11px"},name:"cycleNumber",rules:[function(e){return e.getFieldValue,{validator:function(e,t){return t?Number(t)>10?Promise.reject(new Error("Max loop times is 10")):Promise.resolve():Promise.reject(new Error("Please enter"))}}}]},o().createElement(i.Rn,{type:"number",max:10,precision:0,disabled:!0}))))}var le=function(e){return e.EDITING_ROUTE="editing",e.CREATING_ROUTE="creating",e}({}),ue=function(e){return e.INITIAL_POINT="initial_point",e.WAY_POINT="way_point",e}({}),ce=n(53457),se=n(7501),fe="INIT_ROUTING_EDITOR",me="INIT_ROUTE_MANAGER",pe=ce.Fk.createStoreProvider({initialState:{routingEditor:null,routeManager:null},reducer:function(e,t){return(0,se.Uy)(e,(function(e){switch(t.type){case fe:e.routingEditor=t.payload.routingEditor;break;case me:e.routeManager=t.payload.routeManager}}))}}),de=pe.StoreProvider,ye=pe.useStore,be=n(63483),ve=n(32870);function ge(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,l=[],u=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(l.push(r.value),l.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return l}}(e,t)||he(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function he(e,t){if(e){if("string"==typeof e)return Ee(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ee(e,t):void 0}}function Ee(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function we(e){var t=e.activeOrigin,n=e.destroyFunFavoriteNotFullScreen,a=(0,U.BH)((function(e){return{"favorite-scroll":{width:"284px",maxHeight:"402px",padding:"16px 16px"},"favorite-creating-op":{width:"252px",height:"40px",marginBottom:"10px"},"favorite-common-co":{"& > div:last-child":{borderBottom:"none"}},"favorite-common-item":{height:"40px",color:"#A6B5CC",fontSize:"14px",fontWeight:"400",fontFamily:"PingFangSC-Regular",borderBottom:"1px solid #383B45",cursor:"pointer",display:"flex",justifyContent:"space-between",alignItems:"center","& .favorite-common-item-op-hover":{display:"none"},"&:hover":{width:"268px",background:"rgba(115,193,250,0.08)",borderRadius:"6px",margin:"0px -8px 0px -8px",padding:"0px 8px 0px 8px","& .favorite-common-item-op-no-hover":{display:"none"},"& .favorite-common-item-op-hover":{display:"block"}}},"favorite-common-item-active":{background:"#3288FA !important",borderRadius:"6px",margin:"0px -8px 0px -8px",padding:"0px 8px 0px 8px","& .favorite-common-item-name-cx":{color:"#FFFFFF"},"& .favorite-common-item-op-no-hover-val-cx":{background:"#3288FA"},"& .favorite-common-item-op-no-hover-title-cx":{color:"#FFFFFF !important"},"&: hover":{"& .favorite-common-item-op-hover":{display:"none"},"& .favorite-common-item-op-no-hover":{display:"block"}}},"favorite-common-item-op-no-hover-title":{color:"#808B9D"},"favorite-common-item-op-no-hover-val":{width:"18px",height:"18px",color:"#FFFFFF",fontSize:"12px",textAlign:"center",lineHeight:"18px",marginLeft:"4px",background:"#343C4D",borderRadius:"4px",display:"inline-block"},"favorite-common-item-op-hover-remove":{color:"#FFFFFF",marginLeft:"23px"},"favorite-common-item-name":{width:"150px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},"favorite-warning-co":{padding:"14px 0px 32px 0px",display:"flex",flexDirection:"column",alignItems:"center"},"favorite-warning-co-desc":{width:"195px",color:"#A6B5CC",fontSize:"12px",fontWeight:"400",fontFamily:"PingFangSC-Regular"},"favorite-warning-co-desc-active":{color:"#3288FA",cursor:"pointer"}}}))(),l=a.cx,u=a.classes,c=(0,i.t9)("ic_default_page_no_data"),s=(0,ve.x2)(),f=d(),m=(0,R.R)(),p=m.enterFullScreen,y=(0,g.$G)("routeEditing").t,b=ge(ye(),1)[0],v=b.routeManager,h=b.routingEditor,E=v.currentRouteManager,w=(0,k.Z)(),O=w.mainApi,S=w.isMainConnected,P=ge((0,r.useState)(null),2),C=P[0],x=P[1],j=ge((0,r.useState)([]),2),N=j[0],A=j[1],I=function(){S&&O.getDefaultRoutings().then((function(e){A(e.defaultRoutings.reverse())}))},F=(0,r.useCallback)((function(){t===be.yP.FROM_FULLSCREEN&&(h.pathwayMarker.positionsCount&&S?(0,q.Z)({EE:s,mainApi:O,routeManager:v,routingEditor:h,panelContext:m,isMainConnected:S,defaultRoutingList:N,createCommonRoutingSuccessFunctional:I},ae):(0,i.yw)({type:"error",content:y("NoWayPointMessage")})),t===be.yP.FROM_NOT_FULLSCREEN&&(n(),f("/routing"),p())}),[s,O,N,v,h,m,t,v,S,f,p]);return(0,r.useEffect)((function(){S&&O.getDefaultRoutings().then((function(e){A(e.defaultRoutings.reverse())}))}),[S]),(0,r.useEffect)((function(){var e,t,n,r,o,i;x((e=N,t=E.getCurrentRoute(),o=[null==t||null===(n=t.routePoint)||void 0===n?void 0:n.routeInitialPoint].concat(function(e){if(Array.isArray(e))return Ee(e)}(i=(null==t||null===(r=t.routePoint)||void 0===r?void 0:r.routeWayPoint)||[])||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(i)||he(i)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),e.find((function(e){return e.point.length===o.length&&e.point.every((function(e,t){var n,r,i;return(null==e?void 0:e.heading)===(null===(n=o[t])||void 0===n?void 0:n.heading)&&e.x===(null===(r=o[t])||void 0===r?void 0:r.x)&&e.y===(null===(i=o[t])||void 0===i?void 0:i.y)}))}))))}),[N]),(0,r.useEffect)((function(){t!==be.yP.FROM_NOT_FULLSCREEN&&S&&O.getStartPoint().then((function(e){var t={x:e.x,y:e.y,heading:null==e?void 0:e.heading},n=h.pathwayMarker.lastPosition;O.checkCycleRouting({start:t,end:n}).then((function(e){e.isCycle||v.currentRouteMix.setCurrentRouteMix({currentRouteLoop:{currentRouteLoopState:!1}})}))}))}),[S,t]),o().createElement(X.Z,{className:u["favorite-scroll"]},t!==be.yP.FROM_NOT_FULLSCREEN&&o().createElement(i.zx,{className:u["favorite-creating-op"],onClick:F},y("routeCreateCommonBtn")),N.length?o().createElement("div",{className:u["favorite-common-co"]},N.map((function(e){return o().createElement("div",{key:e.name,onClick:function(){return function(e){x(e);var t=m.panelId,n=e.point[0],r=e.point.slice(1),o=null==e?void 0:e.cycleNumber,i={initialPoint:n,wayPoint:r,cycleNumber:o};v.currentRouteMix.setCurrentRouteMix({currentRouteLoop:{currentRouteLoopState:!!o,currentRouteLoopTimes:o}}),O.setStartPoint({point:n}).then((function(){E.setCurrentRoute({routeOrigin:le.CREATING_ROUTE,routePoint:{routeInitialPoint:n,routeWayPoint:r}}),s.emit(Q.l.SimControlRoute,{panelId:t,routeInfo:i})}))}(e)},className:l(u["favorite-common-item"],C&&C.name===e.name&&u["favorite-common-item-active"])},o().createElement("div",{className:l("favorite-common-item-name-cx",u["favorite-common-item-name"]),title:e.name},e.name),e.cycleNumber&&o().createElement("div",{className:l("favorite-common-item-op-no-hover")},o().createElement("span",{className:l("favorite-common-item-op-no-hover-title-cx",u["favorite-common-item-op-no-hover-title"])},y("looptimes")),o().createElement("span",{className:l("favorite-common-item-op-no-hover-val-cx",u["favorite-common-item-op-no-hover-val"])},e.cycleNumber)),o().createElement("div",{className:l("favorite-common-item-op-hover")},o().createElement("span",{onClick:(t=e.name,function(e){e.stopPropagation(),S&&O.deleteDefaultRouting(t).then((function(){O.getDefaultRoutings().then((function(e){A(e.defaultRoutings.reverse())}))}))}),className:l("favorite-common-item-op-hover-remove-cx",u["favorite-common-item-op-hover-remove"])},o().createElement(J.Z,null))));var t}))):o().createElement("div",{className:u["favorite-warning-co"]},o().createElement("img",{src:c,alt:"resource_empty"}),o().createElement("div",{className:u["favorite-warning-co-desc"]},"".concat(y("createRouteToolTip"),","),o().createElement("span",{className:u["favorite-warning-co-desc-active"],onClick:F},y("goToCreate")))))}const Oe=o().memo(we);function Se(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,l=[],u=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(l.push(r.value),l.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return l}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Pe(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Pe(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Pe(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ce(){var e=$(),t=e.classes,n=e.cx,a=d(),l=Se((0,b.Mq)(),1)[0],u=(0,R.R)().enterFullScreen,c=(0,g.$G)("routeEditing").t,s={popoverDisableText:c("routeEditingBtnOther")},f=Se((0,r.useState)(!1),2),m=f[0],p=f[1],y=Se((0,r.useState)(!1),2),v=y[0],h=y[1],E=Se((0,r.useState)(!0),2),w=E[0],O=E[1],S=o().createElement(Oe,{activeOrigin:be.yP.FROM_NOT_FULLSCREEN,destroyFunFavoriteNotFullScreen:function(){h(!1)}}),P=(0,r.useCallback)((function(){u(),setTimeout((function(){a("/routing")})),(0,K.Ok)({dv_viz_func_name:"Route Editing"})}),[u,a]);return(0,r.useEffect)((function(){l.currentOperation===b.yc.PLAY_RECORDER||l.currentOperation===b.yc.SCENARIO||l.currentOperation===b.yc.SIM_CONTROL||l.currentOperation===b.yc.AUTO_DRIVE?O(!1):O(!0)}),[l]),o().createElement("div",{className:n(w&&t["routing-editing-disable"],t["routing-editing-op-area"])},w?o().createElement(o().Fragment,null,o().createElement(i.J2,{content:null==s?void 0:s.popoverDisableText,trigger:"hover",placement:"top"},o().createElement(o().Fragment,null,o().createElement(G,{onClick:P}))),o().createElement(i.J2,{content:null==s?void 0:s.popoverDisableText,trigger:"hover",placement:"top"},o().createElement(o().Fragment,null,o().createElement(Y,null)))):o().createElement(o().Fragment,null,o().createElement(G,{onClick:P}),o().createElement(i.J2,{content:c("routeCreateCommonBtn"),trigger:"hover",placement:"top",open:m,onOpenChange:function(e){p(e),h(!1)}},o().createElement(i.J2,{content:S,trigger:"click",placement:"rightTop",open:v,onOpenChange:function(e){p(!1),h(e),(0,K.Ok)({dv_viz_func_name:"Common Routing"})},destroyTooltipOnHide:!0},o().createElement(o().Fragment,null,o().createElement(Y,null))))))}var xe=n(84663),je=n(24545),Re=function(e){return e.DEFAULT="Default",e.OVERHEAD="Overhead",e.MAP="Map",e.NEAR="Near",e.TOP_DOWN="TopDown",e}({}),ke=function(e){return e.DEFAULT="Default",e.FOLLOW="Follow",e}({});function Ne(e){return Ne="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ne(e)}function Ae(){return Ae=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Ae.apply(this,arguments)}function Ie(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Fe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ie(Object(n),!0).forEach((function(t){var r,o,i,a;r=e,o=t,i=n[t],a=function(e,t){if("object"!=Ne(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=Ne(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(o),(o="symbol"==Ne(a)?a:String(a))in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ie(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Te(e){var t=(0,U.BH)((function(e){return{"custom-popover":{"&.dreamview-popover .dreamview-popover-inner":{padding:0},"& .dreamview-popover-inner, & .dreamview-popover-arrow::after":{background:"rgba(80, 88, 102, 0.8)"},"& .dreamview-popover-arrow::after":{background:"rgba(80, 88, 102, 0.8)"},"& .dreamview-popover-content .dreamview-popover-inner .dreamview-popover-inner-content":Fe({},e.tokens.typography.content)}}}))(),n=t.classes;return t.cx,o().createElement(i.J2,Ae({},e,{rootClassName:"".concat(n["custom-popover"]," ").concat(e.rootClassName||"")}))}const Me=o().memo(Te);function Le(e){return Le="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Le(e)}function Ve(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function De(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ve(Object(n),!0).forEach((function(t){var r,o,i,a;r=e,o=t,i=n[t],a=function(e,t){if("object"!=Le(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=Le(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(o),(o="symbol"==Le(a)?a:String(a))in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ve(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ze(e){return(0,U.BH)((function(e,t){return{"routing-editing-function-area":De({width:32,position:"absolute",top:25,left:24,color:""},e.util.flex("column","space-around","center")),"routing-editing-function-area__group":{background:e.components.layerMenu.menuItemBg,borderRadius:6,marginBottom:10},"routing-editing-functional__item":De(De({width:32,minWidth:32,height:32,minHeight:32,background:e.components.layerMenu.menuItemBg,borderRadius:6,color:e.components.layerMenu.menuItemColor},e.util.flexCenterCenter),{},{"&:hover":{cursor:"pointer",background:e.components.layerMenu.menuItemBg}}),"hover-color-change":{"&:hover":{color:e.components.layerMenu.menuItemHoverColor}},"routing-editing-functional__item--active":{color:"#3388FA"},"routing-editing-functional__icon":{},"custom-popover-ordinary":{"& .dreamview-popover-inner, & .dreamview-popover-arrow::after":{background:"rgba(80, 88, 102, 0.8) !important"},"& .dreamview-popover-arrow::after":{background:"rgba(80, 88, 102, 0.8) !important"}},"custom-popover-functinal":{"& .dreamview-popover-inner,& .dreamview-popover-arrow::before, & .dreamview-popover-arrow::after":{color:"#A6B5CC !important",background:"rgba(40, 43, 54) !important"},"& .dreamview-popover-arrow::before":{background:"rgba(40, 43, 54) !important"},"& .dreamview-popover-arrow::after":{background:"rgba(40, 43, 54) !important"}},"routing-editing-functional__item--disable":{cursor:"not-allowed","&:hover":{cursor:"not-allowed"}}}}))(e)}function _e(e){return _e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_e(e)}function Be(e,t,n){var r;return r=function(e,t){if("object"!=_e(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=_e(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(t),(t="symbol"==_e(r)?r:String(r))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ke(e,t){var n=e.functionalName,a=e.checkedItem,l=e.onClick,u=e.disable,c=(0,r.useMemo)((function(){return a===n}),[n,a]),s=ze({}),f=s.classes,m=s.cx,p=(0,r.useMemo)((function(){switch(n){case be.Iz.RELOCATE:return o().createElement("i",null,o().createElement(i.Xf,null));case be.Iz.WAYPOINT:return o().createElement("i",null,o().createElement(i.vC,null));case be.Iz.LOOP:return o().createElement("i",null,o().createElement(i.Fc,null));case be.Iz.FAVORITE:return o().createElement("i",null,o().createElement(i.xG,null));default:return null}}),[n]);return o().createElement("div",{ref:t,className:m(f["routing-editing-functional__item"],Be(Be(Be({},f["routing-editing-functional__item--active"],c),f["hover-color-change"],!c),f["routing-editing-functional__item--disable"],u)),onClick:l},o().createElement("div",{className:f["routing-editing-functional__icon"]},p))}const Ue=(0,r.forwardRef)(Ke);var We=function(e){return e.FunctionalRelocateNoActive="initialPoint",e.FunctionalRelocateNoActiveDis="Inial Point is only available for simulation",e.FunctionaWayNoActive="wayPoint",e.FunctionalLoopNoActive="loopRouting",e.FunctionalFavoriteNoActive="commonRouting",e}({});function He(e){var t=e.functionalItemNoActiveText,n=(0,U.BH)((function(e){return{"routing-editing-item-no-active":{padding:"5px 10px",color:"#FFFFFF",fontSize:"14px",fontWeight:"400",fontFamily:"PingFangSC-Regular"}}}))(),r=n.classes,i=(n.cx,(0,g.$G)("routeEditing").t);return o().createElement("div",{className:r["routing-editing-item-no-active"]},i(t))}function Ze(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,l=[],u=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(l.push(r.value),l.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return l}}(e,t)||function(e,t){if(e){if("string"==typeof e)return $e(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?$e(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function $e(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ge(e){var t=(0,U.BH)((function(e){return{"functional-initial-con":{display:"flex"},"functional-initial-every-icon-con":{cursor:"not-allowed"},"functional-initial-disable":{"& .functional-initial-every-icon-disable":{color:"#40454D",pointerEvents:"none"}},"functional-initial-popover":{"& .dreamview-popover-inner-content":{padding:"5px 10px",color:"#FFFFFF",fontFamily:"PingFangSC-Regular",fontSize:"14px",fontWeight:"400"}},"functional-initial-every-icon":{width:"32px",height:"32px",color:"#A6B5CC",display:"flex",justifyContent:"center",alignItems:"center","&:hover":{color:"#D8D8D8",background:"rgba(115,193,250,0.08)"}}}}))(),n=t.classes,a=t.cx,l=Ze(ye(),1)[0].routingEditor,u=(0,g.$G)("routeEditing").t,c=(0,k.Z)(),s=c.isMainConnected,f=c.mainApi,m=Ze((0,r.useState)(l.initiationMarker.positionsCount),2),p=m[0],d=m[1],y=Ze((0,r.useState)(!(p>0)),2),b=y[0],v=y[1];return(0,r.useEffect)((function(){v(!p)}),[p]),o().createElement("div",{className:a(b&&n["functional-initial-disable"],n["functional-initial-con"])},o().createElement(i.J2,{content:u("backToLastPoint"),trigger:"hover",rootClassName:n["functional-initial-popover"]},o().createElement("div",{className:b&&a(n["functional-initial-every-icon-con"])},o().createElement("div",{className:a("functional-initial-every-icon-disable",n["functional-initial-every-icon"]),onClick:function(){var e=l.initiationMarker.undo();s&&(e?f.setStartPoint({point:e}).then((function(){d(l.initiationMarker.positionsCount)})):f.setResetPoint().then((function(){d(l.initiationMarker.positionsCount)})))}},o().createElement(i.jd,null)))),o().createElement(i.J2,{content:u("backToStartPoint"),trigger:"hover",rootClassName:n["functional-initial-popover"]},o().createElement("div",{className:b&&a(n["functional-initial-every-icon-con"])},o().createElement("div",{className:a("functional-initial-every-icon-disable",n["functional-initial-every-icon"]),onClick:function(){s&&f.setResetPoint().then((function(){l.initiationMarker.reset(),d(l.initiationMarker.positionsCount)}))}},o().createElement(i.Nq,null)))))}function Ye(e){return Ye="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ye(e)}function Je(e,t,n){var r;return r=function(e,t){if("object"!=Ye(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=Ye(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(t),(t="symbol"==Ye(r)?r:String(r))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function qe(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,l=[],u=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(l.push(r.value),l.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return l}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Xe(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Xe(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Xe(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Qe(e){var t=(0,U.BH)((function(e){return{"functional-initial-con":{display:"flex"},"functional-initial-every-icon-con":{cursor:"not-allowed"},"functional-initial-disable":{"& .functional-initial-every-icon-disable":{color:"#40454D",pointerEvents:"none"}},"functional-initial-popover":{"& .dreamview-popover-inner-content":{padding:"5px 10px",color:"#FFFFFF",fontFamily:"PingFangSC-Regular",fontSize:"14px",fontWeight:"400"}},"functional-initial-every-icon":{width:"32px",height:"32px",color:"#A6B5CC",display:"flex",justifyContent:"center",alignItems:"center","&:hover":{color:"#D8D8D8",background:"rgba(115,193,250,0.08)"}}}}))(),n=t.classes,a=t.cx,l=qe(ye(),1)[0].routingEditor,u=(0,g.$G)("routeEditing").t,c=qe((0,r.useState)(l.pathwayMarker.positionsCount),2),s=c[0],f=c[1],m=qe((0,r.useState)(!(s>0)),2),p=m[0],d=m[1];return(0,r.useEffect)((function(){d(!s)}),[s]),o().createElement("div",{className:a(Je({},n["functional-initial-disable"],p),n["functional-initial-con"])},o().createElement(i.J2,{content:u("removeLastPoint"),trigger:"hover",rootClassName:n["functional-initial-popover"]},o().createElement("div",{className:a(Je({},n["functional-initial-every-icon-con"],p))},o().createElement("div",{className:a("functional-initial-every-icon-disable",n["functional-initial-every-icon"]),onClick:function(){l.pathwayMarker.undo(),f(l.pathwayMarker.positionsCount)}},o().createElement(i.jd,null)))),o().createElement(i.J2,{content:u("removeAllPoints"),trigger:"hover",rootClassName:n["functional-initial-popover"]},o().createElement("div",{className:a(Je({},n["functional-initial-every-icon-con"],p))},o().createElement("div",{className:a("functional-initial-every-icon-disable",n["functional-initial-every-icon"]),onClick:function(){l.pathwayMarker.reset(),f(l.pathwayMarker.positionsCount)}},o().createElement(i.hO,null)))))}function et(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,l=[],u=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(l.push(r.value),l.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return l}}(e,t)||function(e,t){if(e){if("string"==typeof e)return tt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?tt(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function tt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function nt(e){var t=(0,U.BH)((function(e){return{"functional-loop-con":{width:"257px",padding:"16px 0px 21px 0px",color:"#A6B5CC",fontSize:"14px",fontWeight:"400",fontFamily:"PingFangSC-Regular"},"functional-loop-switch":{width:"160px",height:"20px",margin:"0px 0px 0px 32px",display:"flex",justifyContent:"space-around",alignItems:"center"},"functional-loop-switch-help":{"& .dreamview-popover-arrow::before":{background:"rgba(40, 43, 54) !important"},"& .dreamview-popover-arrow::after":{background:"rgba(40, 43, 54) !important"},"& .dreamview-popover-inner-content":{width:"302px",color:"#FFFFFF",fontSize:"14px",fontWeight:"400",padding:"5px 10px",borderRadius:"6px",fontFamily:"PingFangSC-Regular",background:"rgba(80, 88, 102, 0.8)"}},"functional-loop-switch-remind":{position:"relative",top:"2px"},"functional-loop-input":{height:"32px",margin:"16px 0px 0px 20px",display:"flex",alignItems:"center"},"functional-loop-input-text":{marginRight:"6px"}}}))(),n=t.classes,a=(t.cx,et(ye(),1)[0].routeManager),l=(0,g.$G)("routeEditing").t,u=a.currentRouteMix,c=u.getCurrentRouteMix(),s=et((0,r.useState)(c.currentRouteLoop.currentRouteLoopState),2),f=s[0],m=s[1];return o().createElement("div",{className:n["functional-loop-con"]},o().createElement("div",{className:n["functional-loop-switch"]},o().createElement("div",null,"".concat(l("loopRouting"),":")),o().createElement("div",null,o().createElement(i.rs,{onChange:function(e){e?u.setCurrentRouteMix({currentRouteLoop:{currentRouteLoopState:!0,currentRouteLoopTimes:1}}):u.setCurrentRouteMix({currentRouteLoop:{currentRouteLoopState:!1}}),m(e)},checked:f})),o().createElement(i.J2,{content:l("loopRoutingHelp"),trigger:"hover",placement:"top",rootClassName:n["functional-loop-switch-help"]},o().createElement("div",{className:n["functional-loop-switch-remind"]},o().createElement(i.Ki,null)))),f&&o().createElement("div",{className:n["functional-loop-input"]},o().createElement("div",{className:n["functional-loop-input-text"]},"".concat(l("setLooptimes"),":")),o().createElement("div",null,o().createElement(i.Rn,{min:1,max:10,precision:0,onChange:function(e){u.setCurrentRouteMix({currentRouteLoop:{currentRouteLoopState:!0,currentRouteLoopTimes:e}})},defaultValue:u.getCurrentRouteMix().currentRouteLoop.currentRouteLoopTimes}))))}function rt(e){return rt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},rt(e)}function ot(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function it(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ot(Object(n),!0).forEach((function(t){at(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ot(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function at(e,t,n){var r;return r=function(e,t){if("object"!=rt(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=rt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(t),(t="symbol"==rt(r)?r:String(r))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function lt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,l=[],u=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(l.push(r.value),l.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return l}}(e,t)||function(e,t){if(e){if("string"==typeof e)return ut(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ut(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ut(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ct(e){var t=e.carviz,n=e.changeActiveName,a=e.activeName,l=lt((0,b.Mq)(),2),u=l[0],c=(l[1],lt(ye(),1)[0]),s=c.routeManager,f=c.routingEditor,m=(0,k.Z)(),p=m.isMainConnected,d=m.mainApi,y=(0,g.$G)("routeEditing").t,v=s.currentRouteMix,h=lt((0,r.useState)(null),2),E=h[0],w=h[1],O=u.currentOperation===b.yc.AUTO_DRIVE,S=ze({relocateDisState:O}),P=S.classes,C=S.cx,x=(0,r.useCallback)((function(e,n){var r={routeOrigin:le.EDITING_ROUTE,routePoint:{routeInitialPoint:t.initiationMarker.initiationMarkerPosition,routeWayPoint:t.pathwayMarker.pathWatMarkerPosition}};if(n)if("lastPosition"in n){var o,i,a=n.lastPosition;"edit"===e&&(null===(i=s.currentRouteManager)||void 0===i||i.setScribeCurrentCheckPoint(it(it({},a),{},{type:ue.WAY_POINT}))),null===(o=s.currentRouteManager)||void 0===o||o.setCurrentRoute(r)}else{var l,u;"edit"===e&&(null===(u=s.currentRouteManager)||void 0===u||u.setScribeCurrentCheckPoint(it(it({},n),{},{type:ue.INITIAL_POINT}))),null===(l=s.currentRouteManager)||void 0===l||l.setCurrentRoute(r)}}),[t.initiationMarker,t.pathwayMarker,s.currentRouteManager]);(0,r.useEffect)((function(){Object.values(be.c3).includes(a)&&([be.c3.RELOCATE,be.c3.WAYPOINT].includes(a)||w(null))}),[a,t]),(0,r.useEffect)((function(){var e=function(e){"r"===e.key&&E!==be.Iz.RELOCATE&&(null==t||t.deactiveAll(),w(be.Iz.RELOCATE),null==n||n(be.c3.RELOCATE),null==t||t.initiationMarker.active(x)),"w"===e.key&&E!==be.Iz.WAYPOINT&&(null==t||t.deactiveAll(),w(be.Iz.WAYPOINT),null==n||n(be.c3.WAYPOINT),null==t||t.pathwayMarker.active(x)),(e.ctrlKey||e.metaKey)&&"z"===e.key&&(E===be.Iz.RELOCATE&&(null==t||t.initiationMarker.undo()),E===be.Iz.WAYPOINT&&(null==t||t.pathwayMarker.undo()))};return window.addEventListener("keydown",e),function(){window.removeEventListener("keydown",e)}}),[E]);var j=(0,r.useCallback)((function(e){return function(){if(e!==be.Iz.RELOCATE||!O){if(E===e)return Object.values(be.c3).includes(e)&&(null==t||t.deactiveAll()),void w(null);switch(e){case be.Iz.RELOCATE:w(e),null==t||t.deactiveAll(),null==n||n(be.c3.RELOCATE),null==t||t.initiationMarker.active(x);break;case be.Iz.WAYPOINT:w(e),null==t||t.deactiveAll(),null==n||n(be.c3.WAYPOINT),null==t||t.pathwayMarker.active(x);break;case be.Iz.LOOP:f.pathwayMarker.positionsCount>0?p&&d.getStartPoint().then((function(n){var r={x:n.x,y:n.y,heading:null==n?void 0:n.heading},o=f.pathwayMarker.lastPosition;d.checkCycleRouting({start:r,end:o}).then((function(n){n.isCycle?(w(e),null==t||t.deactiveAll()):(v.setCurrentRouteMix({currentRouteLoop:{currentRouteLoopState:!1}}),(0,i.yw)({type:"error",content:y("NoLoopMessage")}))}))})):(0,i.yw)({type:"error",content:y("NoWayPointMessage")});break;case be.Iz.FAVORITE:w(e),null==t||t.deactiveAll()}}}}),[t,n,E]),R=E===be.Iz.RELOCATE?o().createElement(Ge,null):o().createElement(He,{functionalItemNoActiveText:O?We.FunctionalRelocateNoActiveDis:We.FunctionalRelocateNoActive}),N=E===be.Iz.WAYPOINT?o().createElement(Qe,null):o().createElement(He,{functionalItemNoActiveText:We.FunctionaWayNoActive}),A=E===be.Iz.LOOP?o().createElement(nt,null):o().createElement(He,{functionalItemNoActiveText:We.FunctionalLoopNoActive}),I=E===be.Iz.FAVORITE?o().createElement(Oe,{activeOrigin:be.yP.FROM_FULLSCREEN}):o().createElement(He,{functionalItemNoActiveText:We.FunctionalFavoriteNoActive});return o().createElement("div",{className:P["routing-editing-function-area"]},o().createElement("div",{className:P["routing-editing-function-area__group"]},o().createElement(Me,{content:R,trigger:"hover",placement:"right",mouseLeaveDelay:.5,destroyTooltipOnHide:!0,rootClassName:C(E===be.Iz.RELOCATE?P["custom-popover-functinal"]:P["custom-popover-ordinary"])},o().createElement("div",{className:C(at({},P["func-relocate-ele"],O))},o().createElement(Ue,{functionalName:be.Iz.RELOCATE,checkedItem:E,onClick:j(be.Iz.RELOCATE),disable:O}))),o().createElement(Me,{content:N,trigger:"hover",placement:"right",mouseLeaveDelay:.5,destroyTooltipOnHide:!0,rootClassName:C(E===be.Iz.WAYPOINT?P["custom-popover-functinal"]:P["custom-popover-ordinary"])},o().createElement("div",null,o().createElement(Ue,{functionalName:be.Iz.WAYPOINT,checkedItem:E,onClick:j(be.Iz.WAYPOINT)}))),o().createElement(Me,{content:A,trigger:"hover",placement:"right",mouseLeaveDelay:.5,destroyTooltipOnHide:!0,rootClassName:C(E===be.Iz.LOOP?P["custom-popover-functinal"]:P["custom-popover-ordinary"])},o().createElement("div",null,o().createElement(Ue,{functionalName:be.Iz.LOOP,checkedItem:E,onClick:j(be.Iz.LOOP)})))),o().createElement(Me,{content:I,trigger:"hover",placement:"rightTop",destroyTooltipOnHide:!0,rootClassName:C(E===be.Iz.FAVORITE?P["custom-popover-functinal"]:P["custom-popover-ordinary"])},o().createElement("div",null,o().createElement(Ue,{functionalName:be.Iz.FAVORITE,checkedItem:E,onClick:j(be.Iz.FAVORITE)}))))}const st=o().memo(ct);var ft=function(e){return{type:fe,payload:e}},mt=function(e){return{type:me,payload:e}};function pt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function dt(){var e,t,n=(0,ve.x2)(),r=d(),a=(0,U.BH)((function(e){return{"routing-editing-op-con":{"& > button:nth-of-type(1)":{width:"72px",height:"32px",marginRight:"16px",backgroundColor:e.components.routingEditing.backgroundColor,border:e.components.routingEditing.border,color:e.components.routingEditing.color,"&:hover":{color:e.components.routingEditing.hoverColor,backgroundColor:e.components.routingEditing.backgroundHoverColor,border:e.components.routingEditing.borderHover},"&:active":{color:e.components.routingEditing.activeColor,backgroundColor:e.components.routingEditing.backgroundActiveColor,border:e.components.routingEditing.borderActive}},"& > button:nth-of-type(2)":{width:"114px",height:"32px"}}}}))(),l=a.classes,u=(a.cx,(0,R.R)()),c=(0,k.Z)().mainApi,s=(e=ye(),t=1,function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,l=[],u=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(l.push(r.value),l.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return l}}(e,t)||function(e,t){if(e){if("string"==typeof e)return pt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?pt(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())[0],f=s.routingEditor,m=s.routeManager,p=(0,g.$G)("routeEditing").t;return o().createElement("div",{className:l["routing-editing-op-con"]},o().createElement(i.zx,{ghost:!0,onClick:function(){i.u_.confirm({content:p("cancelEditingRouting"),icon:o().createElement("span",null),onOk:function(){r("/"),u.exitFullScreen()},okText:p("modalConfirmYes"),cancelText:p("modalConfirmNo")})}},p("cancel")),o().createElement(i.zx,{onClick:function(){var e,t=u.panelId,o=f.initiationMarker.initiationMarkerPosition,i={initialPoint:o,wayPoint:f.pathwayMarker.pathWatMarkerPosition,cycleNumber:null===(e=m.currentRouteMix.getCurrentRouteMix().currentRouteLoop)||void 0===e?void 0:e.currentRouteLoopTimes};o||c.getStartPoint().then((function(e){i.initialPoint=e})),m.currentRouteMix.setCurrentRouteMix({currentRouteLoop:{currentRouteLoopState:!1}}),n.emit(Q.l.SimControlRoute,{panelId:t,routeInfo:i}),r("/"),u.exitFullScreen()}},p("saveEditing")))}function yt(e){return yt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},yt(e)}function bt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function vt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?bt(Object(n),!0).forEach((function(t){var r,o,i,a;r=e,o=t,i=n[t],a=function(e,t){if("object"!=yt(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=yt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(o),(o="symbol"==yt(a)?a:String(a))in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):bt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function gt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,l=[],u=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(l.push(r.value),l.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return l}}(e,t)||function(e,t){if(e){if("string"==typeof e)return ht(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ht(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ht(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Et(){var e=(0,g.$G)("routeEditing").t,t=gt(ye(),2),n=t[0].routeManager,a=t[1],l=n.currentRouteManager,u=(0,R.R)().registerFullScreenHooks,c=(0,k.Z)(),s=c.mainApi,f=c.isMainConnected,m=gt((0,w.t)(),2),p=m[0],y=m[1],v=gt((0,r.useState)((function(){return new xe.Z})),1)[0],h=gt((0,r.useState)(null),2),E=h[0],O=h[1],P=function(e){E!==e&&O(e)},C=(0,S.Z)().classes,x=gt((0,b.Mq)(),1)[0],j=d();(0,r.useEffect)((function(){u({afterExitFullScreen:function(){j("/")}})}),[]),(0,r.useEffect)((function(){p.init(),p.view.changeViewType(Re.MAP,!1),a(ft({routingEditor:p}))}),[]);var N=(0,r.useCallback)((function(e){var t,n;null==s||s.getMapElementIds({point:{x:null!==(t=e.x)&&void 0!==t?t:0,y:null!==(n=e.y)&&void 0!==n?n:0},radius:200}).then((function(e){if(!xe.Z.isMapElementIdsEmpty(e)){var t=gt(v.getMapElement(e),2),n=(t[0],t[1]);s.getMapElementsByIds(n).then((function(e){v.updateMapElement(e),null==p||p.updateMap(v.getAllMapElements()),p.render()}))}}))}),[f]);return(0,r.useEffect)((function(){var e;return p.removeAll(),p.deactiveAll(),v.clear(),null==s||s.getMapElementIds({radius:20}).then((function(t){var r=gt(v.getMapElement(t),2),o=(r[0],r[1]);s.getMapElementsByIds(o).then((function(t){if(v.updateMapElement(t),xe.Z.findFirstMapElement(o))try{null==p||p.updateMap(t),p.render(),p.setCameraUpdateCallback(N),null==s||s.getStartPoint().then((function(t){p.coordinates.initialize(t.x,t.y),p.initiationMarker.init(t),N(new je.Vector3(t.x,t.y,0)),e=n.currentRouteManager.subScribeCurrentRoute((function(e){var t=e.routeOrigin,n=e.routePoint;if(t===le.CREATING_ROUTE){var r=n.routeInitialPoint,o=n.routeWayPoint;p.initiationMarker.init(r),p.pathwayMarker.init(o)}}))}))}catch(e){console.error("getMapElementById error",e)}}))})),function(){var t;null===(t=e)||void 0===t||t.unsubscribe()}}),[f,x.currentMap]),(0,r.useEffect)((function(){var t=l.subScribeCurrentCheckPoint((function(t){if(f){var n=t,r=t.type;delete n.type,s.checkRoutingPoint({point:vt(vt({},n),{},{id:0})}).then((function(t){t.isLegal?r===ue.INITIAL_POINT&&s.setStartPoint({point:vt({},n)}):(r===ue.INITIAL_POINT&&(p.initiationMarker.undo(),(0,i.yw)({type:"error",content:e("checkStartPointTooltip")})),r===ue.WAY_POINT&&(p.pathwayMarker.undo(),(0,i.yw)({type:"error",content:e("checkPointTooltip")})))}))}}));return function(){t.unsubscribe()}}),[f]),o().createElement("div",{className:C["viz-container"]},o().createElement("div",{id:y,className:C["web-gl"]}),o().createElement(st,{carviz:p,activeName:E,changeActiveName:P}),o().createElement("div",{className:C["view-btn-container"]},o().createElement(_.Z,{from:"RoutingEditing",carviz:p,activeName:E,changeActiveName:P})),o().createElement("div",{className:C["view-ope-container"]},o().createElement(dt,null)))}var wt=n(41857),Ot=n(17063);function St(e){return St="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},St(e)}function Pt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Ct(r.key),r)}}function Ct(e){var t=function(e,t){if("object"!=St(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=St(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==St(t)?t:String(t)}var xt=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.currentRouteSubject=new wt.X(t),this.currentCheckPointSubject=new Ot.x}var t,n;return t=e,(n=[{key:"getCurrentRoute",value:function(){return this.currentRouteSubject.value}},{key:"setCurrentRoute",value:function(e){this.currentRouteSubject.next(e)}},{key:"subScribeCurrentRoute",value:function(e){return this.currentRouteSubject.subscribe(e)}},{key:"setScribeCurrentCheckPoint",value:function(e){this.currentCheckPointSubject.next(e)}},{key:"subScribeCurrentCheckPoint",value:function(e){return this.currentCheckPointSubject.subscribe(e)}}])&&Pt(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function jt(e){return jt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},jt(e)}function Rt(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,kt(r.key),r)}}function kt(e){var t=function(e,t){if("object"!=jt(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=jt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==jt(t)?t:String(t)}var Nt=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.currentRouteLoop=t.currentRouteLoop}var t,n;return t=e,(n=[{key:"getCurrentRouteMix",value:function(){return{currentRouteLoop:this.currentRouteLoop}}},{key:"setCurrentRouteMix",value:function(e){e.currentRouteLoop&&(this.currentRouteLoop=e.currentRouteLoop)}}])&&Rt(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function At(e){return At="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},At(e)}function It(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Tt(r.key),r)}}function Ft(e,t,n){return t&&It(e.prototype,t),n&&It(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function Tt(e){var t=function(e,t){if("object"!=At(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=At(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==At(t)?t:String(t)}var Mt=Ft((function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.currentRouteManager=new xt(t),this.currentRouteMix=new Nt(n)}));function Lt(e){return Lt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Lt(e)}function Vt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Dt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Vt(Object(n),!0).forEach((function(t){var r,o,i,a;r=e,o=t,i=n[t],a=function(e,t){if("object"!=Lt(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,"string");if("object"!=Lt(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(o),(o="symbol"==Lt(a)?a:String(a))in r?Object.defineProperty(r,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[o]=i})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Vt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function zt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,l=[],u=!0,c=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(l.push(r.value),l.length!==t);u=!0);}catch(e){c=!0,o=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw o}}return l}}(e,t)||function(e,t){if(e){if("string"==typeof e)return _t(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_t(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _t(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Bt(){var e,t,n,a,l,u,c,s,m=(0,S.Z)().classes,p=zt((0,b.Mq)(),1)[0],d=(0,r.useRef)(-1),y=(0,R.R)(),h=(0,r.useContext)(f),P=zt((0,w.Z)(),2),N=P[0],A=P[1],I=(0,r.useRef)([0,0]),F=zt((0,O.Rr)(O.SA.CurrentSwitchView,"Default"),2),T=F[0],M=F[1],L=(0,k.Z)(),V=L.mainApi,B=L.streamApi,K=L.isMainConnected,U=y.logger,W=y.panelId,H=y.subscribeToData,Z=y.updateChannel,$=y.setKeyDownHandlers,G=y.removeKeyDownHandlers,Y=(0,g.$G)("panels").t,J=zt((0,r.useState)(j().Perception.pointCloud.currentVisible),2),q=J[0],X=J[1],Q=zt((0,r.useState)(null),2),ee=Q[0],te=Q[1],ne=zt((0,r.useState)(null!==(e=null===(t=j().Map.boudingBox)||void 0===t?void 0:t.currentVisible)&&void 0!==e&&e),2),re=ne[0],oe=ne[1],ie=zt((0,r.useState)(null!==(n=null===(a=j().Planning.planningBoundaryLine)||void 0===a?void 0:a.currentVisible)&&void 0!==n&&n),2),ae=ie[0],le=ie[1],ue=zt((0,r.useState)(null!==(l=null===(u=j().Planning.planningReferenceLine)||void 0===u?void 0:u.currentVisible)&&void 0!==l&&l),2),ce=ue[0],se=ue[1],fe=zt((0,r.useState)(null!==(c=null===(s=j().Planning.planningTrajectoryLine)||void 0===s?void 0:s.currentVisible)&&void 0!==c&&c),2),me=fe[0],pe=fe[1],de=(0,r.useMemo)((function(){return p.currentOperation===b.yc.WAYPOINT_FOLLOW?ke.FOLLOW:ke.DEFAULT}),[p.currentOperation]),ye=zt((0,r.useState)(de),2),be=ye[0],ve=ye[1],ge=(0,r.useRef)(),he=(0,r.useRef)(null),Ee=(0,r.useRef)(null),we=function e(){null==N||N.render(),ge.current=requestIdleCallback((function(){e()}),{timeout:1e3})},Oe=function(){null==N||N.updateData({object:[],autoDrivingCar:{}}),null==N||N.render(),null!=Ee&&Ee.current&&Ee.current.unsubscribe(),he.current&&he.current.subscription&&(he.current.subscription.unsubscribe(),he.current=null)};(0,r.useEffect)((function(){ve(de)}),[de]),(0,r.useEffect)((function(){N.init();var e=j();x.set(e),N.option.updateLayerOption(C(e),"vehicle"),e.Perception.pointCloud.currentVisible&&setTimeout((function(){Z({name:v.DU.POINT_CLOUD,needChannel:!1})}),0)}),[]),(0,r.useEffect)((function(){var e=[{keys:["="],functionalKey:"ctrlKey",handler:function(e){var t;e.preventDefault(),null===(t=N.view)||void 0===t||t.updateViewDistance(-10)},discriptor:Y("zoomIn")},{keys:["="],functionalKey:"metaKey",handler:function(e){var t;e.preventDefault(),null===(t=N.view)||void 0===t||t.updateViewDistance(-10)},discriptor:Y("zoomIn")},{keys:["-"],functionalKey:"ctrlKey",handler:function(e){var t;e.preventDefault(),null===(t=N.view)||void 0===t||t.updateViewDistance(10)},discriptor:Y("zoomOut")},{keys:["-"],functionalKey:"metaKey",handler:function(e){var t;e.preventDefault(),null===(t=N.view)||void 0===t||t.updateViewDistance(10)},discriptor:Y("zoomOut")}];return $(e),function(){G(e)}}),[Y]);var Se=function(e){var t,n,r,o=Dt(Dt({},e),{},{boudingBox:!!re}),i=null,a=(null==o||null===(t=o.planningData)||void 0===t?void 0:t.path)||[];return Array.isArray(null==o||null===(n=o.planningData)||void 0===n?void 0:n.path)?(ae||(i=["planning_path_boundary_1_regular/self","candidate_path_regular/self","planning_path_boundary_2_regular/self","planning_path_boundary_1_fallback/self","candidate_path_fallback/self","planning_path_boundary_2_fallback/self"],o.planningData.path=a.filter((function(e){return!i.includes(e.name)}))),a=(null==o||null===(r=o.planningData)||void 0===r?void 0:r.path)||[],ce||(i=["planning_reference_line"],o.planningData.path=a.filter((function(e){return!i.includes(e.name)}))),!me&&o.planningTrajectory&&(o.planningTrajectory=[]),o):o};(0,r.useEffect)((function(){if(K){if("/"!==h.currentPath)return function(){return null};var e=null,t=null;if(be===ke.FOLLOW){N.removeAll(),N.view.setViewType("Overhead");var n=H({name:v.DU.SIM_WORLD,needChannel:!1});n&&(t=n.subscribe((function(e){if(e&&0!==Object.keys(e).length){var t={autoDrivingCar:e.autoDrivingCar,followPlanningData:e.planningTrajectory};N.updateData(t)}})))}if(be===ke.DEFAULT){N.follow.dispose();var r=E()((function(e){V.getRoutePath().then((function(t){if(d.current=e.routingTime,0!==Object.keys(e).length){var n=Dt({},e);n.routePath=t.routePath,N.updateData(Se(n)),null==N||N.pointCloud.updateOffsetPosition()}}))}),500,{leading:!0}),o=H({name:v.DU.SIM_WORLD,needChannel:!1});o&&(t=o.subscribe((function(e){if(e){var t=e.autoDrivingCar;if(t){var n,o,i=null!==(n=t.positionX)&&void 0!==n?n:0,a=null!==(o=t.positionY)&&void 0!==o?o:0,l=Math.abs(I.current[0]-i)+Math.abs(I.current[1]-a);U.debug("车辆偏移距离：".concat(l,", 阈值为100")),l>100&&0!==I.current[0]&&0!==I.current[1]&&N&&N.initialized&&(U.debug("车辆偏移距离超过阈值，重置场景"),N.resetScence()),I.current=[i,a]}0!==Object.keys(e).length&&(e.routingTime&&e.routingTime!==d.current?r(e):(N.updateData(Se(e)),null==N||N.pointCloud.updateOffsetPosition()))}})));var i=H({name:v.DU.Map,needChannel:!1});i&&(e=i.subscribe((function(e){e&&(null==N||N.updateMap(e))})))}return function(){be===ke.FOLLOW&&(N.view.setViewType("Default"),t&&t.unsubscribe()),be===ke.DEFAULT&&(e&&e.unsubscribe(),t&&t.unsubscribe())}}}),[be,K,ce,ae,me,re,h.currentPath]),(0,r.useEffect)((function(){return"/"===h.currentPath&&we(),function(){var e=ge.current;e&&cancelIdleCallback(e)}}),[h.currentPath]);var Pe=(0,k.Z)().metadata,xe=(0,r.useMemo)((function(){return Pe.find((function(e){return e.dataName===v.DU.POINT_CLOUD}))}),[Pe,K]),je=(0,r.useMemo)((function(){return xe?xe.channels.map((function(e){return{label:null==e?void 0:e.channelName,value:null==e?void 0:e.channelName}})):[]}),[xe]),Re=(0,r.useMemo)((function(){var e,t=null===(e=Pe.find((function(e){return e.dataName===v.DU.POINT_CLOUD})))||void 0===e||null===(e=e.channels)||void 0===e?void 0:e.filter((function(e){return(null==e?void 0:e.channelName.includes("compensator"))||(null==e?void 0:e.channelName.includes("fusion"))})).sort((function(e){return null!=e&&e.channelName.includes("compensator")?-1:1}));return Array.isArray(t)?t[0]:""}),[Pe]),Ne=(0,O._)("".concat(W,"-viz-pointcloud-channel"));(0,r.useEffect)((function(){var e=null;if(K){var t=Ne.get();q&&t&&(e=H({name:v.DU.POINT_CLOUD,channel:t,needChannel:!0}))&&(Ee.current=e.subscribe((function(e){e&&(null==N||N.updatePointCloud(e))})),te(t))}return function(){Ee.current&&Ee.current.unsubscribe(),N.pointCloud.disposeLastFrame()}}),[Pe,q,K]),(0,r.useEffect)((function(){return function(){var e;null===(e=he.current)||void 0===e||null===(e=e.subscription)||void 0===e||e.unsubscribe()}}),[]);var Ae=o().createElement(D,{carviz:N,pointCloudFusionChannel:Re,handlePointCloudVisible:X,curChannel:ee,setCurChannel:te,pointcloudChannels:je,updatePointcloudChannel:function(e){Oe();var t=B.subscribeToDataWithChannel(v.DU.POINT_CLOUD,e).subscribe((function(e){e&&(null==N||N.updatePointCloud(e))}));he.current={name:v.DU.POINT_CLOUD,subscription:t}},closeChannel:Oe,handleReferenceLineVisible:se,handleBoundaryLineVisible:le,handleTrajectoryLineVisible:pe,handleBoudingBoxVisible:oe});return o().createElement("div",{className:m["viz-container"]},o().createElement("div",{id:A,className:m["web-gl"]}),o().createElement("div",{className:m["viz-btn-container"]},o().createElement(_.Z,{from:"VehicleViz",carviz:N},o().createElement(i.J2,{placement:"leftTop",content:Ae,trigger:"click"},o().createElement("span",{className:m["viz-btn-item"]},o().createElement(i.Le,null))),o().createElement(i.J2,{overlayClassName:m["layer-menu-popover"],placement:"leftBottom",content:o().createElement(z.Z,{carviz:N,setCurrentView:M}),trigger:"click",style:{padding:"0 !importent"}},o().createElement("span",{className:m["viz-btn-item"]},null==T?void 0:T.charAt(0))))),o().createElement(Ce,null))}function Kt(){var e=zt(ye(),2)[1],t={routeOrigin:le.EDITING_ROUTE,routePoint:{routeInitialPoint:null,routeWayPoint:[]}},n={currentRouteLoop:{currentRouteLoopState:!1}};return(0,r.useEffect)((function(){e(mt({routeManager:new Mt(t,n)}))}),[]),o().createElement(m,{initialPath:"/"},o().createElement(y,{path:"/",style:{minWidth:"244px",height:"100%",position:"relative"}},o().createElement(Bt,null)),o().createElement(p,{path:"/routing",style:{width:"100%",height:"100%"}},o().createElement(Et,null)))}function Ut(){return o().createElement(de,null,o().createElement(Kt,null))}function Wt(e){var t=(0,r.useMemo)((function(){return(0,B.Z)({PanelComponent:Ut,panelId:e.panelId})}),[]);return o().createElement(t,e)}Ut.displayName="VehicleViz";const Ht=o().memo(Wt)}}]);